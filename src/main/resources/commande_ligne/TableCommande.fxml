<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.effect.*?>
<?import javafx.scene.chart.*?>

<VBox xmlns="http://javafx.com/javafx/11.0.1" xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="controller.TableCommandesController" spacing="15"
      style="-fx-background-color: #F4F6FA; -fx-padding: 15;"
      stylesheets="@/styles/productsTable.css"
      prefHeight="800.0" prefWidth="1100.0">

    <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-background-color: #2c3e50; -fx-background-radius: 5; -fx-padding: 12;">
        <effect>
            <DropShadow radius="5" spread="0.2" color="rgba(0,0,0,0.1)"/>
        </effect>

        <Label text="RECHERCHER" style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold;"/>

        <TextField fx:id="searchField" promptText="ID ou adresse"
                   onKeyReleased="#filtrerCommandes"
                   style="-fx-background-color: #ecf0f1; -fx-background-radius: 4; -fx-prompt-text-fill: #7f8c8d; -fx-padding: 5;"
                   prefWidth="200"/>

        <Label text="STATUT" style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold;"/>

        <ComboBox fx:id="statutFilter" onAction="#filtrerCommandes"
                  style="-fx-background-color: #ecf0f1; -fx-background-radius: 4;"
                  prefWidth="150">
            <effect>
                <InnerShadow radius="2" color="rgba(0,0,0,0.1)"/>
            </effect>
        </ComboBox>

        <Label text="PAIEMENT" style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold;"/>

        <ComboBox fx:id="paiementFilter" onAction="#filtrerCommandes"
                  style="-fx-background-color: #ecf0f1; -fx-background-radius: 4;"
                  prefWidth="150">
            <effect>
                <InnerShadow radius="2" color="rgba(0,0,0,0.1)"/>
            </effect>
        </ComboBox>

        <Label text="MONTANT (DT)" style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold;"/>

        <TextField fx:id="minMontantFilter" promptText="Min"
                   onKeyReleased="#filtrerCommandes"
                   style="-fx-background-color: #ecf0f1; -fx-background-radius: 4; -fx-prompt-text-fill: #7f8c8d; -fx-padding: 5;"
                   prefWidth="80"/>

        <TextField fx:id="maxMontantFilter" promptText="Max"
                   onKeyReleased="#filtrerCommandes"
                   style="-fx-background-color: #ecf0f1; -fx-background-radius: 4; -fx-prompt-text-fill: #7f8c8d; -fx-padding: 5;"
                   prefWidth="80"/>

        <Label text="DATE" style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold;"/>

        <TextField fx:id="minDateFilter" promptText="yyyy-MM-dd"
                   onKeyReleased="#filtrerCommandes"
                   style="-fx-background-color: #ecf0f1; -fx-background-radius: 4; -fx-prompt-text-fill: #7f8c8d; -fx-padding: 5;"
                   prefWidth="100"/>

        <TextField fx:id="maxDateFilter" promptText="yyyy-MM-dd"
                   onKeyReleased="#filtrerCommandes"
                   style="-fx-background-color: #ecf0f1; -fx-background-radius: 4; -fx-prompt-text-fill: #7f8c8d; -fx-padding: 5;"
                   prefWidth="100"/>

        <Label text="TRIER" style="-fx-text-fill: #ecf0f1; -fx-font-weight: bold;"/>

        <ComboBox fx:id="sortFilter" onAction="#filtrerCommandes"
                  style="-fx-background-color: #ecf0f1; -fx-background-radius: 4;"
                  prefWidth="120">
            <effect>
                <InnerShadow radius="2" color="rgba(0,0,0,0.1)"/>
            </effect>
        </ComboBox>
    </HBox>

    <TableView fx:id="commandesTable"  styleClass="table-view">
        <columns>
            <TableColumn fx:id="idColumn" text="ID" prefWidth="60" style="-fx-alignment: CENTER;"/>
            <TableColumn fx:id="dateColumn" text="DATE" prefWidth="120"/>
            <TableColumn fx:id="montantColumn" text="MONTANT (DT)" prefWidth="100" style="-fx-alignment: CENTER_RIGHT;"/>
            <TableColumn fx:id="statutColumn" text="STATUT" prefWidth="150"/>
            <TableColumn fx:id="adresseColumn" text="ADRESSE LIVRAISON" prefWidth="350"/>
        </columns>
    </TableView>

    <HBox spacing="15" alignment="CENTER_RIGHT" style="-fx-padding: 10 0;">
        <Button fx:id="showMapBtn" text="AFFICHER CARTE"
                onAction="#showMap"
                onMouseEntered="#handleMapBtnHover"
                onMouseExited="#handleMapBtnUnhover"
                style="-fx-background-color: #e67e22; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 4; -fx-padding: 8 15;"/>
        <Button fx:id="modifierStatutBtn" text="MODIFIER STATUT"
                onAction="#modifierStatut"
                onMouseEntered="#handleStatutBtnHover"
                onMouseExited="#handleStatutBtnUnhover"
                style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 4; -fx-padding: 8 15;"/>
        <Button fx:id="modifierAdresseBtn" text="MODIFIER ADRESSE"
                onAction="#modifierAdresse"
                onMouseEntered="#handleAdresseBtnHover"
                onMouseExited="#handleAdresseBtnUnhover"
                style="-fx-background-color: #2ecc71; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 4; -fx-padding: 8 15;"/>
        <Button fx:id="exportExcelBtn" text="EXPORTER EXCEL"
                onAction="#exportToExcel"
                onMouseEntered="#handleExportBtnHover"
                onMouseExited="#handleExportBtnUnhover"
                style="-fx-background-color: #8e44ad; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 4; -fx-padding: 8 15;"/>
    </HBox>

    <HBox spacing="20" style="-fx-padding: 15;">
        <VBox style="-fx-background-color: white; -fx-background-radius: 8; -fx-border-color: #dfe6e9; -fx-border-radius: 8; -fx-padding: 15;" prefWidth="350">
            <Label text="Répartition par Statut" style="-fx-font-weight: bold; -fx-font-size: 16; -fx-padding: 0 0 10 0;"/>
            <PieChart fx:id="statusPieChart" prefHeight="250"/>
            <Label text="Montre la distribution des commandes par statut, indiquant le nombre de commandes dans chaque état (Pending, Confirmé, Livré, Annulé)."
                   style="-fx-font-size: 12; -fx-text-fill: #636e72; -fx-padding: 10 0 0 0; -fx-wrap-text: true;"/>
        </VBox>
        <VBox style="-fx-background-color: white; -fx-background-radius: 8; -fx-border-color: #dfe6e9; -fx-border-radius: 8; -fx-padding: 15;" prefWidth="350">
            <Label text="Montant Total par Statut" style="-fx-font-weight: bold; -fx-font-size: 16; -fx-padding: 0 0 10 0;"/>
            <BarChart fx:id="amountBarChart" prefHeight="250">
                <xAxis>
                    <CategoryAxis fx:id="amountXAxis" label="Statut"/>
                </xAxis>
                <yAxis>
                    <NumberAxis fx:id="amountYAxis" label="Montant (DT)"/>
                </yAxis>
            </BarChart>
            <Label text="Affiche le montant total des commandes pour chaque statut, utile pour évaluer la valeur financière par état."
                   style="-fx-font-size: 12; -fx-text-fill: #636e72; -fx-padding: 10 0 0 0; #handleExportBtnHover-fx-wrap-text: true;"/>
        </VBox>
        <VBox style="-fx-background-color: white; -fx-background-radius: 8; -fx-border-color: #dfe6e9; -fx-border-radius: 8; -fx-padding: 15;" prefWidth="350">
            <Label text="Commandes par Date" style="-fx-font-weight: bold; -fx-font-size: 16; -fx-padding: 0 0 10 0;"/>
            <LineChart fx:id="ordersLineChart" prefHeight="250">
                <xAxis>
                    <CategoryAxis fx:id="ordersXAxis" label="Date"/>
                </xAxis>
                <yAxis>
                    <NumberAxis fx:id="ordersYAxis" label="Nombre de Commandes"/>
                </yAxis>
            </LineChart>
            <Label text="Illustre le nombre de commandes passées par jour, montrant les tendances temporelles de l'activité."
                   style="-fx-font-size: 12; -fx-text-fill: #636e72; -fx-padding: 10 0 0 0; -fx-wrap-text: true;"/>
        </VBox>
    </HBox>
</VBox>